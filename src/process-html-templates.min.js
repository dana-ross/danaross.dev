const fs=require("fs"),path=require("path"),beautify=require("beautify"),chalk=require("chalk");module.exports=function(a,b){fs.readdir(b,(c,d)=>{d.forEach(c=>{".html"==path.extname(c)&&renderHTMLPage(b+"/"+c,a)})})};function renderHTMLPage(a,b){const c=isHomeTemplate(a)?b+"/index.html":b+"/"+path.basename(a,".html")+"/index.html";console.log(`üìÑÔ∏è  ${chalk.white("Processing")} ${chalk.blue(a)} ‚Üí ${chalk.yellow(c)}`);let d=fs.readFileSync(a,"utf8");d=replacePlaceholders(replacePartials(d),{url:"http://example.com"}),isHomeTemplate(a)||fs.mkdirSync(b+"/"+path.basename(a,".html")),fs.writeFileSync(c,cleanHTML(d))}function replacePartials(a){const b=/<drr-partial\W?name="(?<name>[^"]*)"\W?(?<attributes>.+="[^"]+"?)*\W?\/?>(<\/drr-partial>)?/;for(let c=null;c=a.match(b);){const d=replacePartials(replacePlaceholders(fs.readFileSync("./partials/"+c.groups.name+".part","utf8"),parseAttributeString(c.groups.attributes||"")));a=a.replace(b,d)}return a}function parseAttributeString(a){let b=new Map;return a.split("\" ").forEach(a=>{attribute=a.replace(/"$/,"").split("=\""),b=b.set(attribute[0],attribute[1])}),Object.fromEntries(b)}function replacePlaceholders(a,b){const c=/\${(?<name>\w+)}/;for(let d=null;d=a.match(c);)a=a.replace(c,b[d.groups.name]);return a}function cleanHTML(a){return beautify(a,{format:"html"}).replace(/\n\W*\n/g,"\n")}function isHomeTemplate(a){return"index"==path.basename(a,".html")}